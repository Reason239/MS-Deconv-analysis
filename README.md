# MS-Deconv-analysis
Studying MS Deconv performance on bottam-up data

Последовательность действий:

(1) Скачать из Bottom-up CAH2 файлы 140411_QE_Cah-1.mzXML (сырые данные) и 140411_QE_Cah-1_msdeconv.msalign (результат деятельности MS Deconv)

(2) Напустить msgf+ на 140411_QE_Cah-1.mzXML программу msgf+ и получить файлы  140411_QE_Cah-1.mzid и 140411_QE_Cah-1.tsv, что одно и то же, просто в разных форматах, tsv читаемый

(3) С помощью Pyteomics открыть файлы .mzid (переменная df - dataframe), .mzXML (переменная xml) и .msalign (переменная msalign)

(4) Настроить параметры:

⦁	prec (precision) - погрешность для нахождения соответствий между реальными и теоретическими спектрами - 10ppm или заданное число Da

⦁	index - номер строки в TSV (mzid) для анализа

⦁	isotopes - ищем изотопы от +0 до +(isotopes-1)

⦁	charges - ищем заряды от +1 до +charges

⦁	look_for_internal - ищем ли лесенки из внутренних ионов

⦁	ladders_threshold - ищем лесенки, где найдётся хотя бы столько ионов

⦁	max_len_internal - ищем лесенки длины от 3 до этого значения 

(5) Извлекаем соответствующую index строку mzid, вынимаем номер scan и соответствующие значения m/z и интенсивности из mzXML
Извлекаем массы, cсоответствующие scan из msalign (extract_masses)
Создаём теоретический спектр, вычисляя массы всех b и y ионов нашего белка с помощью Pyteomics. Так же считаем m/z для всех зарядом и изотопов этих b и y ионов.
Каждую массу из msalign сравниваем со всеми теоретическими массами (тех и других не очень много) и ищём совпадения
Каждое значение m/z из теоретического спектра ищем в m/z из mzXML двоичным поиском (тут уже значений больше), совпадения запоминаем
Выводим информацию о количестве найденных совподений
Если lok_for_internal = True, то ищем лесенки: перебираем стартовую позицию для лесенки, зетем перебираем все фрагменты белка с этим фиксированным концом и длины от 3 до max_len_internal. Для каждого определям, встречается ли он в mzXML, перебирая заряды и изотопы и используя двоичный поиск. Также смотрим, встречается ли эта масса в msalign. (Получется, что почти никогда не встречается)
Создаём сводку (summary), где для каждого b и y иона выводим, сколько раз мы нашли его в msalign и mzXML
По индексу иона из сводки можем изобразить соотетствующие ему пики из mzXML (функция draw_ms). По жеданию сохраняя изображение
Также поиск совпадений реализлван в виде процедуры с возможностью сохранения выводимой информации и сводки в текстовый файл.
Или можем провести поиск по нескольким линиям mzid, запоминая, ионы каких масс находит MS Drconv. По результатам этой деятельности получаем гистограмму для масс найденных ионов. Примерно 74% найденных ионов имею массу менее 1500Da
